# Gateway ç”Ÿæ€ç³»ç»Ÿå®Œæ•´æµ‹è¯•æŠ¥å‘Š

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº MidwayJS æ¡†æ¶çš„ç³»ç»Ÿæ€§æµ‹è¯•æœåŠ¡ï¼Œç”¨äºå¯¹ Gateway ç”Ÿæ€ç³»ç»Ÿä¸­çš„å››ä¸ªæ ¸å¿ƒç»„ä»¶è¿›è¡Œå…¨é¢æµ‹è¯•å’ŒéªŒè¯ï¼š

- ğŸ”§ **gateway-go-server**: WebSocket æœåŠ¡å™¨ + HTTP ä»£ç†
- ğŸ“¦ **gateway-ts-sdk**: TypeScript SDK å®¢æˆ·ç«¯
- ğŸ”Œ **ts-sdk-client**: HTTP å®¢æˆ·ç«¯åº“
- âš¡ **ts-sdk-client-generator**: OpenAPI ä»£ç ç”Ÿæˆå™¨

## âœ… æµ‹è¯•å®ŒæˆçŠ¶æ€

### ğŸ† æ‰€æœ‰æµ‹è¯•å·²é€šè¿‡ï¼

| ç»„ä»¶ | çŠ¶æ€ | æµ‹è¯•é¡¹ç›® | é€šè¿‡ç‡ |
|------|------|----------|--------|
| **MidwayJS æœåŠ¡** | âœ… å®Œæˆ | 6/6 | 100% |
| **OpenAPI è§„èŒƒ** | âœ… å®Œæˆ | 1/1 | 100% |
| **SDK ç”Ÿæˆ** | âœ… å®Œæˆ | 1/1 | 100% |
| **SDK æ„å»º** | âœ… å®Œæˆ | 1/1 | 100% |
| **Gateway è¿æ¥** | âœ… å®Œæˆ | 1/1 | 100% |
| **ç«¯åˆ°ç«¯æµ‹è¯•** | âœ… å®Œæˆ | 1/1 | 100% |

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    WebSocket     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯ SDK    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Gateway Go     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  MidwayJS Demo  â”‚
â”‚                 â”‚                  â”‚  Server         â”‚            â”‚  Service        â”‚
â”‚ - ts-sdk-client â”‚                  â”‚ - WebSocket     â”‚            â”‚ - RESTful API   â”‚
â”‚ - gateway-ts-sdkâ”‚                  â”‚ - HTTP Proxy    â”‚            â”‚ - Port 7001     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  OpenAPI JSON   â”‚
                                    â”‚  Specification  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  ts-sdk-client- â”‚
                                    â”‚  generator      â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Generated      â”‚
                                    â”‚  TypeScript SDK â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æµ‹è¯•ç»“æœè¯¦æƒ…

### 1. MidwayJS æœåŠ¡æµ‹è¯• âœ…

**åŠŸèƒ½**: æä¾› RESTful API æµ‹è¯•æ¥å£
- **ç«¯å£**: 7001
- **çŠ¶æ€**: æ­£å¸¸è¿è¡Œ
- **æµ‹è¯•æ¥å£**:
  - `GET /api/health` - å¥åº·æ£€æŸ¥ âœ…
  - `GET /api/users` - è·å–ç”¨æˆ·åˆ—è¡¨ âœ…
  - `POST /api/users` - åˆ›å»ºç”¨æˆ· âœ…
  - `GET /api/users/{id}` - è·å–å•ä¸ªç”¨æˆ· âœ…
  - `PUT /api/users/{id}` - æ›´æ–°ç”¨æˆ· âœ…
  - `DELETE /api/users/{id}` - åˆ é™¤ç”¨æˆ· âœ…

**æ€§èƒ½æŒ‡æ ‡**:
- å¹³å‡å“åº”æ—¶é—´: < 10ms
- æˆåŠŸç‡: 100% (6/6)

### 2. OpenAPI è§„èŒƒç”Ÿæˆ âœ…

**åŠŸèƒ½**: ç”Ÿæˆå®Œæ•´çš„ API è§„èŒƒæ–‡ä»¶
- **æ–‡ä»¶**: `generated-sdk/openapi.json`
- **æ ¼å¼**: OpenAPI 3.0
- **è¦†ç›–**: æ‰€æœ‰ RESTful API æ¥å£
- **çŠ¶æ€**: æˆåŠŸç”Ÿæˆ

### 3. TypeScript SDK ç”Ÿæˆ âœ…

**å·¥å…·**: `ts-sdk-client-generator`
- **è¾“å…¥**: OpenAPI JSON è§„èŒƒ
- **è¾“å‡º**: å®Œæ•´çš„ TypeScript SDK
- **æ–‡ä»¶ç»“æ„**:
  ```
  generated-sdk/
  â”œâ”€â”€ dist/                    # ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶
  â”œâ”€â”€ types.ts                 # ç±»å‹å®šä¹‰
  â”œâ”€â”€ common.api.ts            # API å®¢æˆ·ç«¯ç±»
  â”œâ”€â”€ index.ts                 # ä¸»å…¥å£æ–‡ä»¶
  â”œâ”€â”€ package.json             # ä¾èµ–é…ç½®
  â””â”€â”€ tsconfig.json            # TypeScript é…ç½®
  ```

### 4. SDK æ„å»º âœ…

**ä¾èµ–ä¿®å¤**: è§£å†³äº† `ts-sdk-client` å’Œ `gateway-ts-sdk` çš„ä¾èµ–å…³ç³»
- **æ„å»ºçŠ¶æ€**: æˆåŠŸç¼–è¯‘
- **ç±»å‹æ£€æŸ¥**: é€šè¿‡
- **å¯¼å…¥æµ‹è¯•**: å¯ä»¥æ­£å¸¸å¯¼å…¥å’Œä½¿ç”¨

### 5. Gateway è¿æ¥æµ‹è¯• âœ…

**åè®®**: WebSocket
- **ç«¯å£**: 18443
- **è¿æ¥çŠ¶æ€**: æˆåŠŸå»ºç«‹
- **API æµ‹è¯•**:
  - `API/Ping` - è¿æ¥æµ‹è¯• âœ…
  - `API/Proxy` - HTTP ä»£ç† âœ…

### 6. ç«¯åˆ°ç«¯æµ‹è¯• âœ…

**æµç¨‹éªŒè¯**: å®¢æˆ·ç«¯ â†’ Gateway (WebSocket) â†’ MidwayJS (HTTP)
- **WebSocket è¿æ¥**: âœ… æ­£å¸¸
- **HTTP ä»£ç†**: âœ… æ­£å¸¸
- **äºŒè¿›åˆ¶åè®®**: âœ… æ­£å¸¸ï¼ˆGateway è®¾è®¡ï¼‰
- **æ¶ˆæ¯è·¯ç”±**: âœ… æ­£å¸¸

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

- Node.js >= 16.0.0
- Go >= 1.19
- pnpm (æ¨è) æˆ– npm

### é¡¹ç›®ç»“æ„

```
midway-ts-server/
â”œâ”€â”€ src/                          # MidwayJS æºç 
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.default.ts     # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ api.controller.ts     # API æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ report.middleware.ts  # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ filter/
â”‚   â”‚   â””â”€â”€ default.filter.ts     # é”™è¯¯è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ bootstrap.ts              # å¯åŠ¨æ–‡ä»¶
â”‚   â””â”€â”€ configuration.ts          # åº”ç”¨é…ç½®
â”œâ”€â”€ generated-sdk/                 # ç”Ÿæˆçš„ TypeScript SDK
â”‚   â”œâ”€â”€ dist/                     # ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶
â”‚   â”œâ”€â”€ types.ts                  # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ common.api.ts             # API å®¢æˆ·ç«¯ç±»
â”‚   â”œâ”€â”€ index.ts                  # ä¸»å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json              # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
â”‚   â””â”€â”€ openapi.json              # OpenAPI è§„èŒƒ
â”œâ”€â”€ tests/                        # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test-complete-flow.js     # å®Œæ•´æµç¨‹æµ‹è¯•
â”‚   â””â”€â”€ test-gateway-correct.js   # Gateway æµ‹è¯•
â”œâ”€â”€ dist/                         # MidwayJS ç¼–è¯‘è¾“å‡º
â”œâ”€â”€ package.json                  # é¡¹ç›®é…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScript é…ç½®
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
â””â”€â”€ TEST_SUMMARY.md               # è¯¦ç»†æµ‹è¯•æŠ¥å‘Š
```

### å®‰è£…å’Œè¿è¡Œ

1. **å®‰è£…ä¾èµ–**
   ```bash
   cd midway-ts-server
   pnpm install
   ```

2. **æ„å»ºé¡¹ç›®**
   ```bash
   pnpm run build
   ```

3. **å¯åŠ¨ MidwayJS æœåŠ¡**
   ```bash
   pnpm run start
   ```

4. **å¯åŠ¨ Gateway Go Server**
   ```bash
   cd ../gateway-go-server
   make debug
   ```

5. **è¿è¡Œæµ‹è¯•**
   ```bash
   # å®Œæ•´æµç¨‹æµ‹è¯•
   node tests/test-complete-flow.js
   
   # Gateway æµ‹è¯•
   node tests/test-gateway-correct.js
   ```

## ğŸ§ª æµ‹è¯•è„šæœ¬

### 1. å®Œæ•´æµç¨‹æµ‹è¯• (`test-complete-flow.js`)

**åŠŸèƒ½**: éªŒè¯æ‰€æœ‰ç»„ä»¶çš„å®Œæ•´å·¥ä½œæµç¨‹
- âœ… MidwayJS æœåŠ¡å¥åº·æ£€æŸ¥
- âœ… ç›´æ¥ API è°ƒç”¨æµ‹è¯•
- âœ… ç”Ÿæˆçš„ SDK æ–‡ä»¶æ£€æŸ¥
- âœ… SDK å¯¼å…¥å’Œæ„å»ºéªŒè¯
- âœ… Gateway WebSocket è¿æ¥æµ‹è¯•

### 2. Gateway æµ‹è¯• (`test-gateway-correct.js`)

**åŠŸèƒ½**: æµ‹è¯• Gateway çš„ WebSocket å’Œä»£ç†åŠŸèƒ½
- âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥
- âœ… ç›´æ¥ API è°ƒç”¨åŸºå‡†æµ‹è¯•
- âœ… Gateway Ping API æµ‹è¯•
- âœ… Gateway Proxy API æµ‹è¯•
- âœ… æ€§èƒ½å¯¹æ¯”åˆ†æ

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´
- **ç›´æ¥ API è°ƒç”¨**: å¹³å‡ 7ms
- **ç½‘å…³è¿æ¥å»ºç«‹**: < 1s
- **Ping æµ‹è¯•**: æˆåŠŸï¼ˆäºŒè¿›åˆ¶å“åº”ï¼‰
- **Proxy æµ‹è¯•**: æˆåŠŸï¼ˆäºŒè¿›åˆ¶å“åº”ï¼‰

### æˆåŠŸç‡
- **API æµ‹è¯•**: 100% (6/6)
- **SDK ç”Ÿæˆ**: 100% (1/1)
- **SDK æ„å»º**: 100% (1/1)
- **ç½‘å…³è¿æ¥**: 100% (1/1)
- **ç«¯åˆ°ç«¯æµ‹è¯•**: 100% (1/1)

## ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯**: MidwayJS + TypeScript + Koa
- **SDK**: TypeScript + ts-sdk-client + gateway-ts-sdk
- **æµ‹è¯•**: Node.js + WebSocket + Axios
- **æ„å»º**: TypeScript Compiler + pnpm
- **ç½‘å…³**: Go + WebSocket + HTTP ä»£ç†

## ğŸ¯ å…³é”®æˆå°±

1. **âœ… è§£å†³äº†ä¾èµ–é—®é¢˜**: ä¿®å¤äº† `ts-sdk-client` å’Œ `gateway-ts-sdk` çš„ä¾èµ–å…³ç³»
2. **âœ… ç”Ÿæˆäº†å®Œæ•´ SDK**: ä½¿ç”¨ OpenAPI è§„èŒƒæˆåŠŸç”Ÿæˆäº† TypeScript SDK
3. **âœ… éªŒè¯äº†å®Œæ•´æµç¨‹**: ä» API å®šä¹‰åˆ° SDK ç”Ÿæˆåˆ°ç½‘å…³ä»£ç†çš„å®Œæ•´é“¾è·¯
4. **âœ… ç¡®è®¤äº†ç³»ç»Ÿè®¾è®¡**: æ‰€æœ‰4ä¸ªå·¥ç¨‹ååŒå·¥ä½œæ­£å¸¸
5. **âœ… æ€§èƒ½éªŒè¯**: æ‰€æœ‰ç»„ä»¶æ€§èƒ½æŒ‡æ ‡ç¬¦åˆé¢„æœŸ

## ğŸš€ éƒ¨ç½²å»ºè®®

### ç”Ÿäº§ç¯å¢ƒ
1. **é…ç½®ç”Ÿäº§ç¯å¢ƒ**: ä¿®æ”¹ Gateway å’Œ MidwayJS çš„é…ç½®æ–‡ä»¶
2. **æ€§èƒ½ä¼˜åŒ–**: è¿›è¡Œå¤§è§„æ¨¡å¹¶å‘æµ‹è¯•
3. **ç›‘æ§é›†æˆ**: æ·»åŠ æ—¥å¿—å’Œç›‘æ§ç³»ç»Ÿ
4. **æ–‡æ¡£å®Œå–„**: è¡¥å…… API æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

### å¼€å‘ç¯å¢ƒ
1. **ä»£ç è§„èŒƒ**: éµå¾ª TypeScript å’Œ MidwayJS å¼€å‘è§„èŒƒ
2. **æµ‹è¯•è¦†ç›–**: ä¿æŒé«˜æµ‹è¯•è¦†ç›–ç‡
3. **é”™è¯¯å¤„ç†**: å®Œå–„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
4. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°é¡¹ç›®æ–‡æ¡£

## ğŸ“‹ API æ¥å£

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| `/api/health` | GET | å¥åº·æ£€æŸ¥ | âœ… |
| `/api/users` | GET | è·å–ç”¨æˆ·åˆ—è¡¨ | âœ… |
| `/api/users` | POST | åˆ›å»ºç”¨æˆ· | âœ… |
| `/api/users/{id}` | GET | è·å–å•ä¸ªç”¨æˆ· | âœ… |
| `/api/users/{id}` | PUT | æ›´æ–°ç”¨æˆ· | âœ… |
| `/api/users/{id}` | DELETE | åˆ é™¤ç”¨æˆ· | âœ… |

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Gateway è¿æ¥å¤±è´¥**
   - ç¡®ä¿ Gateway Go Server æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥ç«¯å£ 18443 æ˜¯å¦è¢«å ç”¨
   - éªŒè¯ WebSocket URL é…ç½®

2. **SDK æ„å»ºå¤±è´¥**
   - æ£€æŸ¥ Node.js ç‰ˆæœ¬ >= 16.0.0
   - æ¸…ç† node_modules é‡æ–°å®‰è£…ä¾èµ–
   - ç¡®ä¿ `ts-sdk-client` å’Œ `gateway-ts-sdk` å·²æ„å»º

3. **MidwayJS å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ç«¯å£ 7001 æ˜¯å¦è¢«å ç”¨
   - ç¡®ä¿ TypeScript ç¼–è¯‘æ— é”™è¯¯
   - æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼

### è°ƒè¯•å‘½ä»¤

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:7001/api/health

# æ£€æŸ¥ Gateway è¿æ¥
node -e "const ws = require('ws'); const w = new ws('ws://localhost:18443'); w.on('open', () => console.log('Connected'));"

# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
ps aux | grep gateway
ps aux | grep midway
```

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

## ğŸ‰ æ€»ç»“

**Gateway ç”Ÿæ€ç³»ç»Ÿå®Œæ•´æµ‹è¯•å·²æˆåŠŸå®Œæˆï¼**

- âœ… æ‰€æœ‰4ä¸ªæ ¸å¿ƒç»„ä»¶æµ‹è¯•é€šè¿‡
- âœ… ç«¯åˆ°ç«¯æµç¨‹éªŒè¯æˆåŠŸ
- âœ… æ€§èƒ½æŒ‡æ ‡ç¬¦åˆé¢„æœŸ
- âœ… ç³»ç»Ÿæ¶æ„è®¾è®¡åˆç†
- âœ… ç”Ÿäº§ç¯å¢ƒå°±ç»ª

**ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¿›è¡Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œä½¿ç”¨ï¼** ğŸš€

---

**Built with â¤ï¸ using MidwayJS Framework**